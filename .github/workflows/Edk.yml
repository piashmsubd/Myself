name: Clean Root Space

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  clean:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Remove unnecessary packages
      run: |
        sudo apt-get autoremove
        sudo apt-get clean
        sudo apt-get autoclean

    - name: Remove old kernels
      run: |
        sudo apt-get remove --purge $(dpkg -l 'linux-*' | awk '/^ii/{ print $2}' | grep -E '[0-9]+\.[0-9]+\.[0-9]+' | grep -v $(uname -r))

    - name: Remove orphaned packages
      run: |
        sudo deborphan | xargs sudo apt-get -y remove --purge

    - name: Clear systemd journal logs
      run: |
        sudo journalctl --vacuum-time=2weeks

    - name: Remove unused Docker images and containers
      run: |
        docker system prune -a -f

    - name: Find and remove large files
      run: |
        sudo find / -type f -size +100M
        sudo rm -f /path/to/large_file  # Replace with actual file paths

    

    - name: Verify disk space
      run: |
        df -h
